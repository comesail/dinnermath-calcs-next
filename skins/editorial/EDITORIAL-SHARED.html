<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dessert Quantity Calculator</title>
<style>
  html,body{margin:0;background:#fafafa;color:#111;font-family:system-ui,Segoe UI,Arial,sans-serif}
  .wrap{max-width:1080px;margin:36px auto;padding:0 20px}
  h1{font-weight:300;font-size:38px;line-height:1.06;margin:0 0 6px;text-align:center}
  .lede{max-width:70ch;color:#555;margin:4px auto 24px;text-align:center;font-weight:300}
  .box{background:#fff;border:1px solid #eaeaea;padding:20px;margin:16px 0}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .row > *{flex:1 1 120px}
  .label{font-weight:600;margin:8px 0}
  .radio-card{border:1px solid #eaeaea;padding:14px;margin:8px 0}
  .muted{color:#666;font-size:14px}
  .step{color:#d7d7d7;font-size:32px;font-weight:300;margin:24px 0 8px}
  .results-figure{font-size:56px;font-weight:300;margin:8px 0}
  .summary{color:#555;margin-top:8px}
  input[type="number"]{width:100%;padding:10px;border:1px solid #ddd}
</style>
</head>
<body>
<div class="wrap">
  <header class="box" style="text-align:center">
    <h1>{DESSERT NAME} Quantity Calculator</h1>
    <p class="lede">Enter guests and settings (or tap a preset). We will estimate how many servings you need (planning estimate).</p>
  </header>

  <!-- STEP 1: ROLE FIRST (your requested order) -->
  <section class="box" aria-label="Step 1 Role">
    <div class="step">1</div>
    <h3 class="label">Will this be the only dessert you are serving?</h3>
    <p class="muted">We will use this starting portion to customize your results.</p>
    <label class="radio-card">
      <input type="radio" name="role" value="1.00" data-label="Only dessert" checked> Only dessert (full serving)
      <div class="muted">Full servings.</div>
    </label>
    <label class="radio-card">
      <input type="radio" name="role" value="0.60" data-label="One of several desserts"> One of several desserts
      <div class="muted">Smaller serving.</div>
    </label>
    <label class="radio-card">
      <input type="radio" name="role" value="0.45" data-label="Small portion"> Small portion
      <div class="muted">Small plated portion.</div>
    </label>
    <label class="radio-card">
      <input type="radio" name="role" value="0.35" data-label="Tasting bite"> Tasting bite
      <div class="muted">Tiny sampling size.</div>
    </label>
  </section>

  <!-- STEP 2: GUESTS -->
  <section class="box" aria-label="Step 2 Guests">
    <div class="step">2</div>
    <h3 class="label">Guests</h3>
    <div class="row">
      <div>
        <div class="label">Adults</div>
        <input id="adults" type="number" min="0" value="5">
      </div>
      <div>
        <div class="label">Teens</div>
        <input id="teens" type="number" min="0" value="0">
      </div>
      <div>
        <div class="label">Children</div>
        <input id="children" type="number" min="0" value="0">
      </div>
    </div>
    <div class="muted">Presets:
      <a href="#" class="preset" data-n="10">10</a> ·
      <a href="#" class="preset" data-n="25">25</a> ·
      <a href="#" class="preset" data-n="50">50</a> ·
      <a href="#" class="preset" data-n="100">100</a>
    </div>
  </section>

  <!-- STEP 3: APPETITE -->
  <section class="box" aria-label="Step 3 Appetite">
    <div class="step">3</div>
    <h3 class="label">How generous would you like the portions to be?</h3>
    <label class="radio-card">
      <input type="radio" name="appetite" value="0.90" data-label="Light"> Light
      <div class="muted">Smaller portions for lighter appetites.</div>
    </label>
    <label class="radio-card">
      <input type="radio" name="appetite" value="1.00" data-label="Moderate" checked> Moderate
      <div class="muted">Standard portions (fits most events).</div>
    </label>
    <label class="radio-card">
      <input type="radio" name="appetite" value="1.15" data-label="Generous"> Generous
      <div class="muted">Heftier portions for bigger appetites.</div>
    </label>
  </section>

  <!-- STEP 4: DESSERT OPTIONS (generic; brownies specifics can be wired later) -->
  <section class="box" aria-label="Step 4 Dessert options">
    <div class="step">4</div>
    <h3 style="text-align:center">Dessert options</h3>
    <div class="row">
      <div>
        <div class="label">Toppings bar</div>
        <select id="toppings">
          <option value="no" selected>No</option>
          <option value="yes">Yes (+10%)</option>
        </select>
      </div>
      <div>
        <div class="label">Item input A (optional)</div>
        <input id="item-input-a" placeholder="e.g., flavor or pan size">
      </div>
      <div>
        <div class="label">Item input B (optional)</div>
        <input id="item-input-b" placeholder="e.g., slice size or toppings">
      </div>
    </div>
  </section>

  <!-- RESULTS -->
  <section class="box" id="box-results" aria-label="Results">
    <h3>Estimated servings</h3>
    <div class="results-figure" id="result-number">0.0 servings</div>
    <div class="summary" id="input-summary">Guests: 5/0/0 · Appetite: Moderate · Role: Only dessert</div>
    <div class="note" style="margin-top:8px">The estimate includes a small built-in cushion. Additional rounding is usually not needed.</div>
  </section>
</div>

<script>
/* ===== bootstrap: load JSON by slug ===== */
function getSlugFromLocation(){
  const u = new URL(window.location.href);
  const s = u.searchParams.get('slug');
  if (s) return s;
  const m = u.pathname.match(/(?:\/|^)([^\/]+)\.html$/);
  return m ? m[1] : 'cheesecake';
}
async function bootstrap(){
  const slug = getSlugFromLocation();
  const res = await fetch('../../data/' + slug + '.json');
  if(!res.ok){ console.error('Failed to load JSON for', slug); return; }
  const data = await res.json();
  window.DM_DATA = data;

  // Title from display_name or slug
  const h1 = document.querySelector('h1');
  if(h1){
    const nice = (data.display_name || slug.replace(/-/g,' '));
    h1.textContent = nice + ' Quantity Calculator';
    document.title = h1.textContent;
  }
  updateAll();
}

/* ===== helpers ===== */
function dmNum(s){
  if(!s) return 0;
  s = String(s).trim();
  if(s.includes('/')){
    const [a,b] = s.split('/').map(Number);
    if(isFinite(a)&&isFinite(b)&&b) return a/b;
  }
  const n = Number(s.replace(/[^0-9.]/g,''));
  return isFinite(n)? n : 0;
}
function dmParseBaseline(str){
  const m = (str||'').trim().match(/^([\d.\/]+)\s*(.+)?$/);
  return { num: m ? dmNum(m[1]) : 0, unit: (m && m[2]) ? m[2].trim() : 'servings' };
}
function dmRoundDessert(n){
  n = Number(n)||0;
  const base = Math.floor(n), rem = n-base;
  if(n <= 8) return Math.ceil(n);
  if(rem >= 0.8) return base+1;
  return Math.round(n);
}

/* ===== constants ===== */
const DM_AE = { adult:1.00, teen:0.75, child:0.50 };

/* ===== main calc used by render ===== */
function calcServings(){
  const base = dmParseBaseline(window.DM_DATA?.adult_cooked_baseline || '1 piece');
  const A = dmNum(document.getElementById('adults')?.value);
  const T = dmNum(document.getElementById('teens')?.value);
  const C = dmNum(document.getElementById('children')?.value);
  const AE = A*DM_AE.adult + T*DM_AE.teen + C*DM_AE.child;

  const role = parseFloat(document.querySelector('input[name="role"]:checked')?.value || '1.00');
  const appetite = parseFloat(document.querySelector('input[name="appetite"]:checked')?.value || '1.00');

  let total = AE * base.num * role * appetite;
  if(document.getElementById('toppings')?.value === 'yes') total *= 1.10;

  return { value: dmRoundDessert(total), unit: base.unit||'servings' };
}

/* ===== render ===== */
function updateSummary(){
  const A = dmNum(document.getElementById('adults')?.value);
  const T = dmNum(document.getElementById('teens')?.value);
  const C = dmNum(document.getElementById('children')?.value);
  const ap = document.querySelector('input[name="appetite"]:checked')?.dataset?.label || 'Moderate';
  const rl = document.querySelector('input[name="role"]:checked')?.dataset?.label || 'Only dessert';
  const s = document.getElementById('input-summary');
  if(s) s.textContent = 'Guests: '+[A||0,T||0,C||0].join('/')+' · Appetite: '+ap+' · Role: '+rl;
}
function renderResults(){
  const r = calcServings();
  const el = document.getElementById('result-number');
  if(el) el.textContent = (Math.round(r.value*10)/10).toFixed(1) + ' ' + r.unit;
  updateSummary();
}
function updateAll(){ renderResults(); }

/* ===== UX: presets + select-all ===== */
document.addEventListener('click', function(e){
  const a = e.target.closest('a.preset'); if(!a) return;
  e.preventDefault();
  const n = Number(a.dataset.n||0);
  const A=document.getElementById('adults'),T=document.getElementById('teens'),C=document.getElementById('children');
  if(A&&T&&C){ A.value=n; T.value=0; C.value=0; updateAll(); A.focus(); A.select(); }
});
['adults','teens','children'].forEach(id=>{
  const el=document.getElementById(id);
  if(!el) return;
  el.addEventListener('focus', function(){ this.select(); });
  el.addEventListener('click', function(){ this.select(); });
});

/* ===== live updates ===== */
['input','change'].forEach(evt=>{
  ['adults','teens','children','item-input-a','item-input-b','toppings'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.addEventListener(evt, updateAll);
  });
  document.querySelectorAll('input[name="appetite"], input[name="role"]').forEach(el=>el.addEventListener(evt, updateAll));
});

/* ===== go ===== */
document.addEventListener('DOMContentLoaded', bootstrap);
</script>
</body>
</html>

