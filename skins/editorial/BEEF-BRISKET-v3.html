<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="dm-skin" content="editorial-v1.1">
  <title>Beef Brisket Quantity Calculator</title>

  <link rel="stylesheet" href="./editorial-v1.1.css">
  <script defer src="../../engine/engine.v2.js"></script>
  <script defer src="../../runner/runner.v2.js"></script>
</head>

<body class="dm-editorial">
<main id="calculator" class="dm-grid">

  <!-- Header -->
  <section class="card">
    <h1>Beef Brisket Quantity Calculator</h1>
    <p>Plan how much brisket to cook or buy for your crowd. Adjust guests, appetite, and pricing as needed.</p>
  </section>

  <!-- Inputs -->
  <section class="card">
    <div class="step-label">Step 1 - Guests</div>
    <div class="field-grid">
      <label>
        <span>Adults</span>
        <input id="adults" class="dm-num" type="text" inputmode="numeric" pattern="[0-9]*" value="10" aria-label="Adults">
      </label>
      <label>
        <span>Teens</span>
        <input id="teens" class="dm-num" type="text" inputmode="numeric" pattern="[0-9]*" value="0" aria-label="Teens">
      </label>
      <label>
        <span>Children</span>
        <input id="children" class="dm-num" type="text" inputmode="numeric" pattern="[0-9]*" value="0" aria-label="Children">
      </label>
    </div>

    <div class="step-label">Step 2 - Appetite</div>
    <label>
      <span>How generous would you like the portions to be?</span>
      <select id="appetite" aria-label="Appetite level">
        <option value="0.90">Light 0.90</option>
        <option value="1.00" selected>Moderate 1.00</option>
        <option value="1.15">Generous 1.15</option>
      </select>
    </label>
    <div id="appetite-whisper" class="note">Allows for standard portions, fits most gatherings.</div>

    <!-- Hidden factors per spec -->
    <input type="hidden" id="role" value="1.00">
    <input type="hidden" id="leftovers" value="1.00">
    <input type="hidden" id="length" value="1.00">
  </section>

  <!-- Pricing -->
  <section class="card pricing">
    <div class="step-label">Step 3 - Pricing</div>
    <div class="field-grid">
      <label>
        <span>Unit price (dollars per lb)</span>
        <input id="unitPrice" class="dm-num" type="text" inputmode="decimal" value="0.00" aria-label="Unit price per pound">
      </label>
      <label>
        <span>Sales tax percent</span>
        <input id="taxPct" class="dm-num" type="text" inputmode="decimal" value="0" aria-label="Sales tax percent">
      </label>
      <label>
        <span>Other fees (dollars)</span>
        <input id="fees" class="dm-num" type="text" inputmode="decimal" value="0.00" aria-label="Other fees">
      </label>
    </div>
    <div class="note">Optional. Leave blank for price-free planning.</div>
  </section>

  <!-- Results -->
  <section class="card results">
    <div class="step-label">Step 4 - Results</div>
    <div id="result-line" class="headline">Enter guests to see the brisket estimate.</div>
    <div id="result-pricing" class="note">Pricing appears when unit price is provided.</div>
  </section>

  <!-- Finder -->
  <section class="card finder">
    <div class="step-label">Step 5 - Finder</div>
    <div class="actions">
      <a href="#" id="finder-primary" class="btn primary">Find brisket near me</a>
      <a href="#" id="finder-link-1" class="btn">Butcher shops</a>
      <a href="#" id="finder-link-2" class="btn">Grocery stores</a>
    </div>
    <div class="note">Update these links to your preferred map queries or partners.</div>
  </section>

</main>
<script>
  // Numeric inputs: select-all on focus/click; digits and one dot only.
  (function(){
    function makeNumeric(el){
      function sel(){ el.select(); }
      el.addEventListener("focus", sel);
      el.addEventListener("click", sel);
      el.addEventListener("input", function(){
        var v = el.value.replace(/[^0-9.]/g, "");
        var parts = v.split(".");
        if(parts.length > 2){ v = parts[0] + "." + parts.slice(1).join(""); }
        el.value = v;
      });
    }
    document.querySelectorAll(".dm-num").forEach(makeNumeric);
  })();

  // Appetite whisper
  (function(){
    var appetite = document.getElementById("appetite");
    var whisper = document.getElementById("appetite-whisper");
    function setWhisper(val){
      if(val === "0.90"){ whisper.textContent = "Allows for lighter portions, suited to smaller appetites or lighter eaters."; }
      else if(val === "1.00"){ whisper.textContent = "Allows for standard portions, fits most gatherings."; }
      else { whisper.textContent = "Allows for heartier portions, ideal for guests who tend to eat a bit more."; }
    }
    appetite.addEventListener("change", function(){ setWhisper(appetite.value); trigger(); });
    setWhisper(appetite.value);
  })();

  // Compute constants (spec-locked)
  (function(){
    var ADULT_COOKED_BASELINE_LB = 0.234; // 3.75 oz cooked per adult
    var TEEN_FACTOR = 0.85;
    var CHILD_FACTOR = 0.60;
    var RAW_TO_COOKED_YIELD = 0.60; // 40 percent shrink

    function n(id, d){
      var el = document.getElementById(id);
      if(!el) return d||0;
      var v = parseFloat(el.value);
      return isFinite(v) ? v : (d||0);
    }

    function roundQuarter(x){ return Math.round(x * 4) / 4; }
    function r2(x){ return Math.round(x * 100) / 100; }

    function priceSummary(rawLb){
      var unit = n("unitPrice", 0);
      var taxPct = n("taxPct", 0);
      var fees = n("fees", 0);
      if(!unit){ return { has:false }; }
      var subtotal = rawLb * unit;
      var tax = subtotal * (taxPct/100);
      var total = subtotal + tax + fees;
      var guests = Math.max(1, n("adults",0)+n("teens",0)+n("children",0));
      return { has:true, subtotal:subtotal, tax:tax, total:total, perPerson: total/guests };
    }

    // Engine v2 hooks
    window.DM_COMPUTE = function(ctx){
      var adults = n("adults", 0);
      var teens = n("teens", 0);
      var children = n("children", 0);

      var appetite = parseFloat(document.getElementById("appetite").value || "1.00");
      var role = parseFloat(document.getElementById("role").value || "1.00");
      var leftovers = parseFloat(document.getElementById("leftovers").value || "1.00");
      var length = 1.00; // hidden for Meat and Seafood

      var adult_equiv = adults + TEEN_FACTOR*teens + CHILD_FACTOR*children;

      var cooked_total_lb = adult_equiv * ADULT_COOKED_BASELINE_LB * appetite * role * leftovers;
      var raw_total_lb = cooked_total_lb / RAW_TO_COOKED_YIELD;

      var display_raw_lb = roundQuarter(raw_total_lb);

      return {
        inputs:{ adults:adults, teens:teens, children:children, appetite:appetite, role:role, leftovers:leftovers, length:length },
        cookedLb: cooked_total_lb,
        rawLb: raw_total_lb,
        rawRounded: display_raw_lb,
        cookedRounded: r2(cooked_total_lb),
        pricing: priceSummary(raw_total_lb)
      };
    };

    window.DM_RENDER = function(out, ctx){
      var totalGuests = out.inputs.adults + out.inputs.teens + out.inputs.children;
      var line = "Enter guests to see the brisket estimate.";
      if(totalGuests > 0){
        line = "Plan about " + out.rawRounded + " lb raw brisket (" + out.cookedRounded + " lb cooked).";
      }
      var lineEl = document.getElementById("result-line");
      if(lineEl) lineEl.textContent = line;

      var priceEl = document.getElementById("result-pricing");
      if(priceEl){
        if(out.pricing && out.pricing.has){
          priceEl.textContent =
            "Estimated cost: $" + out.pricing.subtotal.toFixed(2) +
            " + tax $" + out.pricing.tax.toFixed(2) +
            " + fees = $" + out.pricing.total.toFixed(2) +
            " total ($" + out.pricing.perPerson.toFixed(2) + " per person).";
        } else {
          priceEl.textContent = "Pricing appears when unit price is provided.";
        }
      }
    };

    function trigger(){
      if(typeof window.DM_COMPUTE === "function" && typeof window.DM_RENDER === "function"){
        var out = window.DM_COMPUTE({});
        window.DM_RENDER(out, {});
      }
    }

    ["adults","teens","children","appetite","unitPrice","taxPct","fees"].forEach(function(id){
      var el = document.getElementById(id);
      if(el){ el.addEventListener("input", trigger); el.addEventListener("change", trigger); }
    });

    // Initial render
    trigger();
  })();
</script>
</body>
</html>

