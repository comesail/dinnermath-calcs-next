<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cobbler, Crisp, and Crumble Portion Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #faf7f4;
      color: #222;
    }
    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    h1 {
      font-size: 1.8rem;
      margin: 0 0 8px;
    }
    p.lede {
      margin: 0 0 20px;
      font-size: 0.98rem;
      max-width: 640px;
    }
    .preset-note {
      font-size: 0.75rem;
      color: #666;
      margin-top: 4px;
    }
    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
      gap: 18px;
    }
    @media (max-width: 800px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .card {
      background: #ffffff;
      border-radius: 14px;
      padding: 16px 16px 18px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.04);
    }
    .card + .card {
      margin-top: 12px;
    }
    .step-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 0.96rem;
    }
    .step-num {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: #254cdd;
      color: #fff;
      font-size: 0.86rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .field-row {
      display: flex;
      gap: 10px;
      margin-top: 6px;
      margin-bottom: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .field {
      flex: 1 1 90px;
      min-width: 90px;
    }
    label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 2px;
    }
    input[type="number"],
    select {
      width: 100%;
      box-sizing: border-box;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #d4c5b8;
      font-size: 0.9rem;
      background: #fff;
    }
    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: #254cdd;
      box-shadow: 0 0 0 1px rgba(37,76,221,0.15);
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      margin-bottom: 2px;
    }
    .pill {
      border-radius: 999px;
      border: 1px solid #d4c5b8;
      padding: 4px 10px;
      font-size: 0.78rem;
      cursor: pointer;
      background: #faf7f4;
    }
    .pill:hover {
      background: #f0ebe6;
    }
    .pill.secondary {
      border-style: dashed;
    }
    .small {
      font-size: 0.8rem;
      color: #555;
    }
    .result-label {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 4px;
      font-weight: 600;
    }
    .result-main {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .result-sub {
      font-size: 0.82rem;
      color: #333;
      margin-bottom: 6px;
    }
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      margin-bottom: 6px;
    }
    .chip {
      font-size: 0.76rem;
      padding: 4px 8px;
      background: #f3ede5;
      border-radius: 999px;
    }
    .result-note {
      font-size: 0.8rem;
      color: #444;
      margin-bottom: 8px;
    }
    .result-meta {
      font-size: 0.78rem;
      color: #666;
      margin-bottom: 4px;
    }
    .footer-note {
      font-size: 0.75rem;
      color: #777;
      margin-top: 10px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
<div class="page">
  <h1>Cobbler, Crisp, and Crumble Portion Calculator</h1>
  <p class="lede">
    Enter your crowd and settings. We will estimate how much cobbler, crisp, or crumble to make,
    using dessert level portions and a small built-in cushion.
  </p>

  <div class="grid">
    <!-- Left: inputs -->
    <div>
      <!-- Step 1: Guests -->
      <div class="card">
        <div class="step-label">
          <span class="step-num">1</span>
          <span>How many people are you serving?</span>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="dm-adults">Adults</label>
            <input id="dm-adults" type="number" min="0" value="5">
          </div>
          <div class="field">
            <label for="dm-teens">Teens</label>
            <input id="dm-teens" type="number" min="0" value="0">
          </div>
          <div class="field">
            <label for="dm-children">Children</label>
            <input id="dm-children" type="number" min="0" value="0">
          </div>
        </div>
        <div class="pill-row">
          <button class="pill" data-preset="10">10</button>
          <button class="pill" data-preset="25">25</button>
          <button class="pill" data-preset="50">50</button>
          <button class="pill" data-preset="100">100</button>
          <button class="pill secondary" data-preset="0">Reset</button>
        </div>
        <div class="preset-note">
          Presets set all guests as adults. Tweak Teens and Children if needed.
        </div>
      </div>

      <!-- Step 2: Appetite -->
      <div class="card">
        <div class="step-label">
          <span class="step-num">2</span>
          <span>How generous would you like the portions to be?</span>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="dm-appetite">Appetite level</label>
            <select id="dm-appetite">
              <option value="0.9">
                Light — Allows for lighter portions — suited to smaller appetites or lighter eaters.
              </option>
              <option value="1.0" selected>
                Moderate — Allows for standard portions — fits most gatherings.
              </option>
              <option value="1.15">
                Generous — Allows for heartier portions — ideal for guests who tend to eat a bit more.
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 3: Role / Meal-Share (scoopable) -->
      <div class="card">
        <div class="step-label">
          <span class="step-num">3</span>
          <span>Will this be the only dessert you are serving?</span>
        </div>
        <div class="field-row">
          <div class="field">
            <label for="dm-role">Dessert role</label>
            <select id="dm-role">
              <option value="1.0">
                This is the only dessert being served — Allows for full servings — 1/2 cup (4 oz) per person.
              </option>
              <option value="0.6">
                There will be two or more desserts offered — Allows for smaller servings — 1/3 cup (3 oz) per person.
              </option>
              <option value="0.45">
                I only want to serve a small portion of this dessert — Allows for a few spoonfuls — 1/4 cup (2 oz) per person.
              </option>
              <option value="0.35">
                This is just a small bite or mini sweet to finish the meal — Allows for a tasting scoop — 2 Tbsp (1 oz) per person.
              </option>
            </select>
          </div>
        </div>
      </div>
      <!-- No extra food-specific controls for v1 -->
    </div>

    <!-- Right: results -->
    <div>
      <div class="card">
        <div class="result-label">Estimated cobbler, crisp, or crumble to make</div>
        <div class="result-main" id="dm-result-main">0 cups total</div>
        <div class="result-sub" id="dm-result-sub"></div>
        <div class="chips" id="dm-chips"></div>
        <div class="result-note">
          The estimate above includes a small built-in cushion, so additional rounding up is generally unnecessary.
        </div>
        <div class="result-meta" id="dm-meta"></div>
        <div class="footer-note">
          Use for planning only. DinnerMath provides general portion estimates based on typical dessert patterns
          and category baselines. Actual needs can vary with recipes, pan depth, and guests.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // Adult-equivalent multipliers for Desserts
  const AE = { adult: 1.0, teen: 0.75, child: 0.5 };

  // Dessert baseline for scoopable: full serving at role 1.0 is 1/2 cup per adult-equivalent
  const BASE_CUPS_PER_AE = 0.5;

  // Hybrid generosity cushion (applied once)
  const HYBRID_CUSHION = 1.10;

  // Pan assumptions for helper lines
  const CUPS_PER_9X13 = 12;   // approx 24 dessert servings at 1/2 cup each
  const CUPS_PER_HALF_SHEET = CUPS_PER_9X13 * 2;  // about double a 9x13
  const CUPS_PER_FULL_SHEET = CUPS_PER_9X13 * 4;  // about four 9x13 pans
  const CUPS_PER_QUART = 4;

  // Elements
  const adultsEl  = document.getElementById("dm-adults");
  const teensEl   = document.getElementById("dm-teens");
  const kidsEl    = document.getElementById("dm-children");
  const appEl     = document.getElementById("dm-appetite");
  const roleEl    = document.getElementById("dm-role");

  const mainEl    = document.getElementById("dm-result-main");
  const subEl     = document.getElementById("dm-result-sub");
  const chipsEl   = document.getElementById("dm-chips");
  const metaEl    = document.getElementById("dm-meta");

  // Select-all behavior for guest fields
  [adultsEl, teensEl, kidsEl].forEach(function(input){
    input.addEventListener("focus", function(){
      setTimeout(function(){ input.select(); }, 0);
    });
    input.addEventListener("click", function(){
      input.select();
    });
  });

  // Presets
  document.querySelectorAll(".pill[data-preset]").forEach(function(btn){
    btn.addEventListener("click", function(){
      const val = Number(btn.getAttribute("data-preset")) || 0;
      if (!val) {
        adultsEl.value = 0;
        teensEl.value  = 0;
        kidsEl.value   = 0;
      } else if (val === 10) {
        adultsEl.value = 10;
        teensEl.value  = 0;
        kidsEl.value   = 0;
      } else if (val === 25) {
        adultsEl.value = 25;
        teensEl.value  = 0;
        kidsEl.value   = 0;
      } else if (val === 50) {
        adultsEl.value = 50;
        teensEl.value  = 0;
        kidsEl.value   = 0;
      } else if (val === 100) {
        adultsEl.value = 100;
        teensEl.value  = 0;
        kidsEl.value   = 0;
      }
      recalc();
    });
  });

  [adultsEl, teensEl, kidsEl, appEl, roleEl].forEach(function(el){
    el.addEventListener("input", recalc);
    el.addEventListener("change", recalc);
  });

  function safeNum(v) {
    const n = Number(v);
    return Number.isFinite(n) && n >= 0 ? n : 0;
  }

  function roundCupsWithHybrid(cups) {
    // Apply Hybrid cushion once
    let c = cups * HYBRID_CUSHION;

    if (c <= 8) {
      // For small groups, always round up to next whole cup
      return Math.ceil(c);
    }
    // For larger groups, round to nearest half-cup with slight upward bias
    const halfSteps = Math.ceil(c * 2 - 0.2);
    return halfSteps / 2;
  }

  function recalc() {
    const adults = safeNum(adultsEl.value);
    const teens  = safeNum(teensEl.value);
    const kids   = safeNum(kidsEl.value);

    const appetite = Number(appEl.value) || 1.0;
    const role     = Number(roleEl.value) || 1.0;

    const AE_total =
      adults * AE.adult +
      teens  * AE.teen +
      kids   * AE.child;

    if (!AE_total) {
      mainEl.textContent = "0 cups total";
      subEl.textContent = "";
      chipsEl.innerHTML = "";
      metaEl.textContent = "Guests: 0 adults, 0 teens, 0 children.";
      return;
    }

    // Math order (Desserts): AE -> baseline -> Role -> Appetite -> Hybrid cushion + rounding (unit-based)
    const cupsRaw = AE_total * BASE_CUPS_PER_AE * role * appetite;
    const cupsRounded = roundCupsWithHybrid(cupsRaw);

    const quarts = cupsRounded / CUPS_PER_QUART;
    const pans9x13 = Math.ceil(cupsRounded / CUPS_PER_9X13);
    const halfSheets = Math.ceil(cupsRounded / CUPS_PER_HALF_SHEET);
    const fullSheets = Math.ceil(cupsRounded / CUPS_PER_FULL_SHEET);

    mainEl.textContent =
      cupsRounded.toFixed(1).replace(/\.0$/, "") + " cups total";

    // Build helper text
    var lines = [];
    if (quarts >= 0.5) {
      var qStr = quarts.toFixed(2).replace(/\.00$/, "").replace(/(\.\d)0$/, "$1");
      lines.push("About " + qStr + " quarts overall.");
    }
    if (pans9x13 >= 1) {
      lines.push("Roughly " + pans9x13 + " standard 9x13 inch pan" + (pans9x13 > 1 ? "s." : "."));
    }
    if (halfSheets >= 1 && halfSheets < pans9x13 * 2 + 2) {
      lines.push("About " + halfSheets + " half sheet pan" + (halfSheets > 1 ? "s." : "."));
    }
    if (fullSheets >= 1 && fullSheets < halfSheets * 3 + 2) {
      lines.push("About " + fullSheets + " full sheet pan" + (fullSheets > 1 ? "s." : "."));
    }

    subEl.textContent = lines.join(" ");

    // Chips summary
    chipsEl.innerHTML = "";
    var chipTexts = [];
    chipTexts.push(
      "Guests: " + adults + " adults, " + teens + " teens, " + kids + " children"
    );
    chipTexts.push("Appetite: " + labelForAppetite(appEl.value));
    chipTexts.push("Role: " + labelForRole(roleEl.value));

    chipTexts.forEach(function(text){
      var span = document.createElement("span");
      span.className = "chip";
      span.textContent = text;
      chipsEl.appendChild(span);
    });

    metaEl.textContent =
      "Results use dessert level baselines for scoopable desserts such as cobbler, crisp, crumble, mousse, and pudding.";
  }

  function labelForAppetite(val) {
    if (val === "0.9")  return "Light portions";
    if (val === "1.15") return "Generous portions";
    return "Moderate portions";
  }

  function labelForRole(val) {
    if (val === "1.0")  return "Only dessert being served";
    if (val === "0.6")  return "One of several desserts";
    if (val === "0.45") return "Small portion of this dessert";
    if (val === "0.35") return "Tiny bite to finish the meal";
    return "Dessert share";
  }

  // Initial calculation
  recalc();
})();
</script>
</body>
</html>
